{"version":3,"sources":["App.module.css","../../src/GalleryContext.tsx","../../src/Gallery.tsx","../../src/useChildHeightSpring.ts","../../src/usePreventClick.ts","App.tsx","index.tsx"],"names":["module","exports","initialState","index","length","GalleryContext","createContext","reducer","state","action","value","GalleryProvider","initialIndex","children","useReducer","composeConsumerArgs","to","dispatch","type","prev","next","hasPrev","hasNext","GalleryConsumer","Gallery","containerHeight","showOverflow","className","style","React","useContext","contextIndex","setContextIndex","setContextLength","useInternalGalleryContext","useEffect","useState","setIndex","adaptation","useChildSizes","ref","sizes","useSpring","height","spring","setSpring","heights","immediate","Number","useChildHeightSpring","listRef","listSpring","lengthRef","useRef","prevent","setPrevent","e","usePreventClick","preventClick","useSprings","x","i","itemSprings","setItemSprings","adjust","bind","useDrag","down","mx","movement","vx","vxvy","first","last","distance","disableBodyScroll","requestAnimationFrame","enableBodyScroll","width","mul","Math","axis","styles","animated","onClickCapture","key","transform","v","imageUrls","imageUrlsVariousAspectRatio","App","map","url","App_ImageItem","src","alt","draggable","App_AnchorItem","href","target","rel","App_Control","App_ControlPrev","onClick","disabled","Array","fill","_","toString","isActive","App_ControlNext","ReactDOM","render","document","getElementById"],"mappings":"8IACAA,EAAOC,QAAU,CAAC,IAAM,iBAAiB,cAAgB,2BAA2B,eAAiB,4BAA4B,YAAc,yBAAyB,gBAAkB,6BAA6B,gBAAkB,6BAA6B,SAAW,wB,+YCOjR,IAAMC,EAAsB,CAAEC,MAAF,EAAYC,OAAQ,GAE1CC,EAAiBC,wBAAiD,CAAC,EAAD,MAEtE,eAKIC,EAAU,SAACC,EAAD,GACd,OAAQC,EAAR,MACE,aACE,eAAmBL,OAAQK,EAAOC,QACpC,YACE,eAAmBP,MAAOM,EAAOC,UAS1BC,EAAkD,SAAC,G,QAC9DC,wBAAeA,EAAA,IACfC,aAEMH,EAAQI,qBAAWP,EAAS,EAAV,MAA6BJ,MAAOS,KAC5D,OACE,kBAACP,EAAD,UAAyBK,MAAOA,GADlC,IAiBIK,EAGqB,SAAC,EAAD,G,IAAGZ,UAAOC,WAC7BY,EAAK,SAACN,GACNA,EAAJ,GACIA,GAAJ,GACAO,EAAS,CAAEC,KAAF,QAAiBR,WAM5B,MAAO,CAAEP,MAAF,EAASC,OAAT,EAAiBY,GAAjB,EAAqBG,KAJf,kBAAMH,EAAGb,EAAT,IAIqBiB,KAHrB,kBAAMJ,EAAGb,EAAT,IAG2BkB,QAFxBlB,EAAhB,EAEiDmB,QADjCnB,EAAQC,EAAxB,IAQWmB,EAAkD,SAAC,GAAD,IAC7DV,EAD6D,kBAG7D,kBAACR,EAAD,eACG,uBAAIF,EAAJ,QAAWC,EAAX,SAAqBa,EAArB,YACCJ,EAASE,EAAoB,CAAEZ,MAAF,EAASC,UADvC,Q,0BC5DQoB,EAAkC,SAAC,G,QAC9CC,2BAAkBA,EAAA,W,IAClBC,wBAAeA,GAAA,EACfC,cACAC,UACAf,aAEQT,EAAWyB,wBAAXzB,O,EDkE+B,W,MACb0B,qBAAWzB,GAA9BG,OAAOS,OACd,MAAO,CACLc,aAAcvB,EADT,MAELwB,gBAAiB,mBACff,EAAS,CAAEC,KAAF,QAAiBR,MAAOP,KACnC8B,iBAAkB,mBAChBhB,EAAS,CAAEC,KAAF,SAAkBR,MAAON,MCnElC8B,GAHFH,iBACAC,oBACAC,qBAGFE,qBAAU,WACRF,OACC,CAFHE,I,MAI0BC,mBAASL,GAA5B5B,OAAOkC,O,WC/BdlC,EACAmC,G,MAEqBC,cAAdC,OAAKC,O,EACgBC,qBAAU,iBAAO,CAAEC,OAAQ,MAAhDC,OAAQC,OAwCf,OAtCAV,qBAAU,WACR,IAAMW,EAAUL,EAAA,KAAU,+BAEtBK,EAAA,OAAc,wBAChBD,GAAU,iBAAO,CAAEF,OAAQ,MAIzBG,EAAA,OAAc,mBAAYH,IAAWG,EAAvB,MAChBD,GAAU,iBAAO,CAAEF,OAAQG,EAAV,GAAsBC,WAAW,MAKlDT,uBACAQ,MAFF,IAGEA,KAEAD,GAAU,iBAAO,CAAEF,OAAQG,EAAQ3C,OAEnC0C,EADSP,cAAJ,QAA+BA,EAC1B,iBAAO,CACfK,OAAQG,EAAA,QACE,wBADF,QAGJ,qBAAkBH,MAAlB,IACAK,OAJI,aAQA,iBAAO,CACfL,OAAQG,EAAA,QACN,qBAAkBH,MAAlB,IACAK,OAFM,gBAMX,CAAC7C,EAAOmC,EApCXH,IAsCO,CAACK,EAAR,GDZ8BS,CAAoB,KAA3CC,OAASC,OAIVC,EAAYC,iBAAlB,GACAD,Y,uBEpC8BhB,oBAAS,GAAhCkB,OAIP,MAAO,CAJSC,KACK,SAACC,GACpB,GAAaA,qBFmCoBC,GAA5BF,OAAYG,O,EAEmBC,qBAAWvD,GAAQ,kBAAQ,CAC/DwD,EAAGC,EAAI9B,MADF+B,OAAaC,OAIdC,EAAS,SAAC7D,GAEd,OADA4D,GAAe,kBAAQ,CAAEH,EAAGC,EAAL,EAAgBd,WAAW,MAClD,GAGFZ,qBAAU,WACR6B,KACAhC,OACC,CAHHG,IAKAA,qBAAU,WACRE,OACC,CAFHF,IAIA,IAAM8B,EAAOC,aACX,Y,IAAGC,SAAiBC,E,EAAXC,SAAWD,GAAYE,E,EAAPC,KAAOD,GAAKE,UAAOC,SAAMC,aAChDrC,GAAS,YACP,IAAKa,EAAL,QAAsB,OAAO/C,EAE7B,EACEoD,MACSmB,EAAJ,IACLnB,MACAoB,YAAkBzB,EAAlByB,UAGF,IACEC,uBAAsB,kBAAMrB,GAAN,MACtBsB,YAAiB3B,EAAjB2B,UAGF,IAAMC,EAAQ5B,UAAd,YAEA,KAAU,CACR,IAAM6B,EACH5E,OAAeiE,EAAhB,GACCjE,IAAUiD,UAAVjD,GAAmCiE,EADpC,KADF,EASA,OAJAL,GAAe,kBAAQ,CACrBH,EAAGC,IAAaO,EAAD,EADM,EAErBrB,WAAW,MAEb,EACK,OACEiB,EADEM,GAAJ,GACSU,SAAS7E,EAAT6E,EAAoB5B,UAAlC,GACSkB,EAAJ,GACSU,SAAS7E,EAAT6E,EAAd,GACSZ,GAAJ,GAASU,EACAE,SAAS7E,EAAT6E,EAAoB5B,UAAlC,GACSgB,EAAJ,GAASU,EACAE,SAAS7E,EAAT6E,EAAd,GAEA,QAIN,CACEC,KAAM,MAIV,OACE,yBACEtD,UAAcuD,EAAL,KACPxD,EAAewD,EADR,SAELvD,GAFK,IAGTC,MAAOA,GAEP,kBAACuD,WAAD,oBACMlB,IAAI,CACRzB,IAAKU,EACLtB,MAAOuB,EACPiC,eAAgB1B,IAEfI,EAAA,KAAgB,kBAAGF,EAAH,WACf,kBAACuB,WAAD,IACEE,IAAKxB,aACLjC,MACEF,EACI,CACE4D,UAAW1B,EAAA,IAAK,qCAAsB2B,EAAtB,eAElB,CACED,UAAW1B,EAAA,IAAK,mBACd2B,iCAEI,GAAKA,EAAL,6CAEeA,EALL,gBAUvB1D,wBAnBY,U,yBGlHnB2D,EAAY,CAChB,mDACA,mDACA,mDACA,mDACA,oDAGIC,EAA8B,CAClC,mDACA,oDACA,oDACA,mDACA,oDA6FaC,EA1FH,WACV,OACE,yBAAK/D,UAAWuD,IAAOQ,KACrB,wDACA,uCACA,kBAAC,EAAD,KACGF,EAAUG,KAAI,SAACC,GAAD,OACb,yBACEP,IAAKO,EACLjE,UAAWuD,IAAOW,cAClBC,IAAKF,EACLG,IAAI,GACJC,WAAW,QAKjB,0CACA,kBAAC,EAAD,KACGR,EAAUG,KAAI,SAACC,GAAD,OACb,uBACEP,IAAKO,EACLjE,UAAWuD,IAAOe,eAClBC,KAAMN,EACNO,OAAO,SACPC,IAAI,sBACJJ,WAAW,GAEX,yBAAKF,IAAKF,EAAKG,IAAI,GAAGC,WAAW,SAKvC,8CACA,kBAAC,EAAD,KACGP,EAA4BE,KAAI,SAACC,GAAD,OAC/B,yBACEP,IAAKO,EACLjE,UAAWuD,IAAOW,cAClBC,IAAKF,EACLG,IAAI,GACJC,WAAW,QAKjB,6CACA,kBAAC,EAAD,KACE,kBAAC,EAAD,KACGR,EAAUG,KAAI,SAACC,GAAD,OACb,yBACEP,IAAKO,EACLjE,UAAWuD,IAAOW,cAClBC,IAAKF,EACLG,IAAI,GACJC,WAAW,QAIjB,kBAAC,EAAD,MACG,gBAAG7F,EAAH,EAAGA,MAAOC,EAAV,EAAUA,OAAQY,EAAlB,EAAkBA,GAAIG,EAAtB,EAAsBA,KAAMC,EAA5B,EAA4BA,KAAMC,EAAlC,EAAkCA,QAASC,EAA3C,EAA2CA,QAA3C,OACC,yBAAKK,UAAWuD,IAAOmB,aACrB,4BACE1E,UAAWuD,IAAOoB,gBAClBC,QAASpF,EACTqF,UAAWnF,IAEb,4BACG,IAAIoF,MAAMrG,GAAQsG,KAAK,GAAGf,KAAI,SAACgB,EAAG9C,GAAJ,OAC7B,wBAAIwB,IAAKxB,EAAE+C,YACT,4BACEjF,UAAWkC,IAAM1D,EAAQ+E,IAAO2B,SAAW,GAC3CN,QAAS,kBAAMvF,EAAG6C,WAK1B,4BACElC,UAAWuD,IAAO4B,gBAClBP,QAASnF,EACToF,UAAWlF,WCpG3ByF,IAASC,OAAO,kBAAC,EAAD,MAASC,SAASC,eAAe,W","file":"static/js/main.6d8429c8.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"App\":\"App_App__16ZpL\",\"App_ImageItem\":\"App_App_ImageItem__ygsvZ\",\"App_AnchorItem\":\"App_App_AnchorItem__22eiz\",\"App_Control\":\"App_App_Control__8GaMu\",\"App_ControlPrev\":\"App_App_ControlPrev__st3se\",\"App_ControlNext\":\"App_App_ControlNext__1j6Ck\",\"isActive\":\"App_isActive__W6jtY\"};","import React, { createContext, useContext, useReducer } from 'react'\n\ninterface State {\n  index: number\n  length: number\n}\ntype Action = { type: 'index' | 'length'; value: number }\n\nconst initialState: State = { index: 0, length: 0 }\n\nconst GalleryContext = createContext<[State, (action: Action) => void]>([\n  { ...initialState },\n  () => {}\n])\n\n// provider\n\nconst reducer = (state: State, action: Action) => {\n  switch (action.type) {\n    case 'length':\n      return { ...state, length: action.value }\n    case 'index':\n      return { ...state, index: action.value }\n  }\n}\n\ninterface GalleryProviderProps {\n  initialIndex?: number\n  children: React.ReactNode\n}\n\nexport const GalleryProvider: React.FC<GalleryProviderProps> = ({\n  initialIndex = 0,\n  children\n}) => {\n  const value = useReducer(reducer, { ...initialState, index: initialIndex })\n  return (\n    <GalleryContext.Provider value={value}>{children}</GalleryContext.Provider>\n  )\n}\n\n// consumer\n\ninterface GalleryConsumerArgs {\n  index: number\n  length: number\n  to: (index: number) => void\n  prev: () => void\n  next: () => void\n  hasNext: boolean\n  hasPrev: boolean\n}\n\nconst composeConsumerArgs: (\n  state: { index: number; length: number },\n  dispatch: (action: Action) => void\n) => GalleryConsumerArgs = ({ index, length }, dispatch) => {\n  const to = (value: number) => {\n    if (value < 0) return\n    if (value >= length) return\n    dispatch({ type: 'index', value })\n  }\n  const prev = () => to(index - 1)\n  const next = () => to(index + 1)\n  const hasPrev = index > 0\n  const hasNext = index < length - 1\n  return { index, length, to, prev, next, hasPrev, hasNext }\n}\n\ninterface GalleryConsumerProps {\n  children: (args: GalleryConsumerArgs) => React.ReactNode\n}\n\nexport const GalleryConsumer: React.FC<GalleryConsumerProps> = ({\n  children\n}) => (\n  <GalleryContext.Consumer>\n    {([{ index, length }, dispatch]) =>\n      children(composeConsumerArgs({ index, length }, dispatch))\n    }\n  </GalleryContext.Consumer>\n)\n\n// hook\n\nexport const useGalleryContext: () => GalleryConsumerArgs = () => {\n  const [{ index, length }, dispatch] = useContext(GalleryContext)\n  return composeConsumerArgs({ index, length }, dispatch)\n}\n\nexport const useInternalGalleryContext = () => {\n  const [state, dispatch] = useContext(GalleryContext)\n  return {\n    contextIndex: state.index,\n    setContextIndex: (index: number) =>\n      dispatch({ type: 'index', value: index }),\n    setContextLength: (length: number) =>\n      dispatch({ type: 'length', value: length })\n  }\n}\n","import React, { useEffect, useRef, useState } from 'react'\nimport { animated, useSprings } from 'react-spring'\nimport { disableBodyScroll, enableBodyScroll } from 'body-scroll-lock'\nimport { useDrag } from 'react-use-gesture'\n\nimport { useChildHeightSpring } from './useChildHeightSpring'\nimport { useInternalGalleryContext } from './GalleryContext'\nimport { usePreventClick } from './usePreventClick'\nimport styles from './Gallery.module.css'\n\ninterface GalleryProps {\n  containerHeight?: 'active' | 'min' | 'max'\n  showOverflow?: boolean\n  className?: string\n  style?: React.CSSProperties\n}\n\nexport const Gallery: React.FC<GalleryProps> = ({\n  containerHeight = 'active',\n  showOverflow = false,\n  className,\n  style,\n  children\n}) => {\n  const { length } = React.Children.toArray(children)\n\n  const {\n    contextIndex,\n    setContextIndex,\n    setContextLength\n  } = useInternalGalleryContext()\n\n  useEffect(() => {\n    setContextLength(length)\n  }, [length])\n\n  const [index, setIndex] = useState(contextIndex)\n  const [listRef, listSpring] = useChildHeightSpring<HTMLUListElement>(\n    index,\n    containerHeight\n  )\n  const lengthRef = useRef(length)\n  lengthRef.current = length\n  const [setPrevent, preventClick] = usePreventClick<HTMLUListElement>()\n\n  const [itemSprings, setItemSprings] = useSprings(length, (i) => ({\n    x: i - contextIndex\n  }))\n\n  const adjust = (index: number) => {\n    setItemSprings((i) => ({ x: i - index, immediate: false }))\n    return index\n  }\n\n  useEffect(() => {\n    adjust(index)\n    setContextIndex(index)\n  }, [index])\n\n  useEffect(() => {\n    setIndex(contextIndex)\n  }, [contextIndex])\n\n  const bind = useDrag(\n    ({ down, movement: [mx], vxvy: [vx], first, last, distance }) => {\n      setIndex((index) => {\n        if (!listRef.current) return index\n\n        if (first) {\n          setPrevent(false)\n        } else if (distance > 5) {\n          setPrevent(true)\n          disableBodyScroll(listRef.current)\n        }\n\n        if (last) {\n          requestAnimationFrame(() => setPrevent(false))\n          enableBodyScroll(listRef.current)\n        }\n\n        const width = listRef.current.offsetWidth\n\n        if (down) {\n          const mul =\n            (index === 0 && mx > 0) ||\n            (index === lengthRef.current - 1 && mx < 0)\n              ? 0.5\n              : 1\n          setItemSprings((i) => ({\n            x: i - index + (mx / width) * mul,\n            immediate: true\n          }))\n          return index\n        } else if (vx < -0.5) {\n          return adjust(Math.min(index + 1, lengthRef.current - 1))\n        } else if (vx > 0.5) {\n          return adjust(Math.max(index - 1, 0))\n        } else if (mx < width * -0.5) {\n          return adjust(Math.min(index + 1, lengthRef.current - 1))\n        } else if (mx > width * 0.5) {\n          return adjust(Math.max(index - 1, 0))\n        } else {\n          return adjust(index)\n        }\n      })\n    },\n    {\n      axis: 'x'\n    }\n  )\n\n  return (\n    <div\n      className={`${styles.Gallery} ${\n        showOverflow ? styles.isShowOverflow : ''\n      } ${className || ''}`}\n      style={style}\n    >\n      <animated.ul\n        {...bind()}\n        ref={listRef}\n        style={listSpring}\n        onClickCapture={preventClick}\n      >\n        {itemSprings.map(({ x }, i) => (\n          <animated.li\n            key={i.toString()}\n            style={\n              showOverflow\n                ? {\n                    transform: x.to((v) => `translate3d(${v * 100}%, 0, 0)`)\n                  }\n                : {\n                    transform: x.to((v) =>\n                      v <= -1\n                        ? 'translate3d(-100%, 0, 0)'\n                        : 1 <= v\n                        ? 'translate3d(100%, 0, 0)'\n                        : `translate3d(${v * 100}%, 0, 0)`\n                    )\n                  }\n            }\n          >\n            {React.Children.toArray(children)[i]}\n          </animated.li>\n        ))}\n      </animated.ul>\n    </div>\n  )\n}\n","import { RefObject, useEffect } from 'react'\nimport { SpringValue, useSpring } from 'react-spring'\nimport { useChildSizes } from 'use-child-sizes'\n\nexport function useChildHeightSpring<T extends HTMLElement>(\n  index: number,\n  adaptation: 'active' | 'min' | 'max'\n): [RefObject<T>, { height: SpringValue<number> }] {\n  const [ref, sizes] = useChildSizes<T>()\n  const [spring, setSpring] = useSpring(() => ({ height: 0 }))\n\n  useEffect(() => {\n    const heights = sizes.map(({ height }) => height)\n\n    if (heights.every((height) => !height)) {\n      setSpring(() => ({ height: 0 }))\n      return\n    }\n\n    if (heights.every((height) => height === heights[0])) {\n      setSpring(() => ({ height: heights[0], immediate: true }))\n      return\n    }\n\n    if (\n      adaptation === 'active' &&\n      heights[index] !== undefined &&\n      heights[index] !== 0\n    ) {\n      setSpring(() => ({ height: heights[index] }))\n    } else if (adaptation === 'active' || adaptation === 'min') {\n      setSpring(() => ({\n        height: heights\n          .filter((height) => height)\n          .reduce(\n            (min, height) => (height < min ? height : min),\n            Number.MAX_VALUE\n          )\n      }))\n    } else {\n      setSpring(() => ({\n        height: heights.reduce(\n          (max, height) => (height > max ? height : max),\n          Number.MIN_VALUE\n        )\n      }))\n    }\n  }, [index, adaptation, sizes])\n\n  return [ref, spring]\n}\n","import React, { useState } from 'react'\n\nexport function usePreventClick<T extends HTMLElement>(): [\n  (prevent: boolean) => void,\n  (e: React.MouseEvent<T>) => void\n] {\n  const [prevent, setPrevent] = useState(false)\n  const preventClick = (e: React.MouseEvent<T>) => {\n    if (prevent) e.preventDefault()\n  }\n  return [setPrevent, preventClick]\n}\n","import React from 'react'\nimport {\n  Gallery,\n  GalleryProvider,\n  GalleryConsumer\n} from 'react-chromeless-gallery'\nimport 'react-chromeless-gallery/dist/index.css'\n\nimport styles from './App.module.css'\n\nconst imageUrls = [\n  'https://source.unsplash.com/F-gfrzSIPZo/1600x900',\n  'https://source.unsplash.com/f68m3uHNT_A/1600x900',\n  'https://source.unsplash.com/xsIOCYmlI1g/1600x900',\n  'https://source.unsplash.com/KMn4VEeEPR8/1600x900',\n  'https://source.unsplash.com/6ArTTluciuA/1600x900'\n]\n\nconst imageUrlsVariousAspectRatio = [\n  'https://source.unsplash.com/F-gfrzSIPZo/1600x900',\n  'https://source.unsplash.com/f68m3uHNT_A/1600x1200',\n  'https://source.unsplash.com/xsIOCYmlI1g/1600x1600',\n  'https://source.unsplash.com/KMn4VEeEPR8/1600x700',\n  'https://source.unsplash.com/6ArTTluciuA/1600x800'\n]\n\nconst App = () => {\n  return (\n    <div className={styles.App}>\n      <h1>React Chromeless Gallery</h1>\n      <h2>Minimal</h2>\n      <Gallery>\n        {imageUrls.map((url) => (\n          <img\n            key={url}\n            className={styles.App_ImageItem}\n            src={url}\n            alt=''\n            draggable={false}\n          />\n        ))}\n      </Gallery>\n\n      <h2>With links</h2>\n      <Gallery>\n        {imageUrls.map((url) => (\n          <a\n            key={url}\n            className={styles.App_AnchorItem}\n            href={url}\n            target='_blank'\n            rel='noopener noreferrer'\n            draggable={false}\n          >\n            <img src={url} alt='' draggable={false} />\n          </a>\n        ))}\n      </Gallery>\n\n      <h2>Various height</h2>\n      <Gallery>\n        {imageUrlsVariousAspectRatio.map((url) => (\n          <img\n            key={url}\n            className={styles.App_ImageItem}\n            src={url}\n            alt=''\n            draggable={false}\n          />\n        ))}\n      </Gallery>\n\n      <h2>With controls</h2>\n      <GalleryProvider>\n        <Gallery>\n          {imageUrls.map((url) => (\n            <img\n              key={url}\n              className={styles.App_ImageItem}\n              src={url}\n              alt=''\n              draggable={false}\n            />\n          ))}\n        </Gallery>\n        <GalleryConsumer>\n          {({ index, length, to, prev, next, hasPrev, hasNext }) => (\n            <div className={styles.App_Control}>\n              <button\n                className={styles.App_ControlPrev}\n                onClick={prev}\n                disabled={!hasPrev}\n              />\n              <ul>\n                {new Array(length).fill(0).map((_, i) => (\n                  <li key={i.toString()}>\n                    <button\n                      className={i === index ? styles.isActive : ''}\n                      onClick={() => to(i)}\n                    />\n                  </li>\n                ))}\n              </ul>\n              <button\n                className={styles.App_ControlNext}\n                onClick={next}\n                disabled={!hasNext}\n              />\n            </div>\n          )}\n        </GalleryConsumer>\n      </GalleryProvider>\n    </div>\n  )\n}\n\nexport default App\n","import './index.css'\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}